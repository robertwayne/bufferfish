class D{inner;position;reading;maxCapacity;textDecoder;textEncoder;constructor(j=new ArrayBuffer(0)){this.inner=new Uint8Array(j),this.position=0,this.reading=!1,this.maxCapacity=1024,this.textDecoder=void 0,this.textEncoder=void 0}write(j){if(this.maxCapacity>0&&(j.length>this.maxCapacity||this.inner.length+j.length>this.maxCapacity))return new Error(`Bufferfish capacity exceeded (${this.maxCapacity} bytes)`);this.reading=!1;let q=new Uint8Array(this.inner.length+j.length);q.set(this.inner,0),q.set(j,this.inner.length),this.inner=q;let z=j.length;return this.position+=z,z}bytes=()=>{return this.inner.subarray()};startReading=()=>{if(this.reading)return;this.position=0,this.reading=!0};setMaxCapacity=(j)=>{this.maxCapacity=j};isEmpty=()=>{return this.inner.length===0};length=()=>{return this.inner.length};reset=()=>{this.inner=new Uint8Array(0),this.position=0,this.reading=!1};peek=()=>{this.startReading();let j=this.inner.slice(this.position,this.position+1)[0];if(this.position>=this.inner.length||j===void 0)return new Error(`peek of 1 byte exceeds the max capacity of ${this.maxCapacity} bytes on this Bufferfish`);return j};peekN=(j)=>{this.startReading();let q=this.inner.slice(this.position,this.position+j);if(this.position+j>this.inner.length)return new Error(`peek of ${j} bytes exceeds the max capacity of ${this.maxCapacity} bytes on this Bufferfish`);return q};writeUint8=(j)=>{if(j>255||j<0)return new Error(`value ${j} must be between 0 and 255`);let q=new Uint8Array(1);new DataView(q.buffer).setUint8(0,j);let x=this.write(q);if(x instanceof Error)return x};writeUint16=(j)=>{if(j>65535||j<0)return new Error(`value ${j} must be between 0 and 65535`);let q=new Uint8Array(2);new DataView(q.buffer).setUint16(0,j);let x=this.write(q);if(x instanceof Error)return x};writeUint32=(j)=>{if(j>4294967295||j<0)return new Error(`value ${j} must be between 0 and 4294967295`);let q=new Uint8Array(4);new DataView(q.buffer).setUint32(0,j);let x=this.write(q);if(x instanceof Error)return x};writeUint64=(j)=>{if(j>BigInt("18446744073709551615")||j<BigInt(0))return new Error(`value ${j} must be between 0 and 18446744073709551615`);let q=new Uint8Array(8);new DataView(q.buffer).setBigUint64(0,j);let x=this.write(q);if(x instanceof Error)return x};writeUint128=(j)=>{if(j>BigInt("340282366920938463463374607431768211455")||j<BigInt(0))return new Error(`value ${j} must be between 0 and 340282366920938463463374607431768211455`);let q=new Uint8Array(16),z=new DataView(q.buffer);z.setBigUint64(0,j>>64n),z.setBigUint64(8,j&BigInt("0xffffffffffffffff"));let x=this.write(q);if(x instanceof Error)return x};writeInt8=(j)=>{if(j>127||j<-128)return new Error(`value ${j} must be between -128 and 127`);let q=new Uint8Array(1);new DataView(q.buffer).setInt8(0,j);let x=this.write(q);if(x instanceof Error)return x};writeInt16=(j)=>{if(j>32767||j<-32768)return new Error(`value ${j} must be between -32768 and 32767`);let q=new Uint8Array(2);new DataView(q.buffer).setInt16(0,j);let x=this.write(q);if(x instanceof Error)return x};writeInt32=(j)=>{if(j>2147483647||j<-2147483648)return new Error(`value ${j} must be between -2147483648 and 2147483647`);let q=new Uint8Array(4);new DataView(q.buffer).setInt32(0,j);let x=this.write(q);if(x instanceof Error)return x};writeInt64=(j)=>{if(j>BigInt("9223372036854775807")||j<BigInt("-9223372036854775808"))return new Error(`value ${j} must be between -9223372036854775808 and 9223372036854775807`);let q=new Uint8Array(8);new DataView(q.buffer).setBigInt64(0,j);let x=this.write(q);if(x instanceof Error)return x};writeInt128=(j)=>{if(j>BigInt("170141183460469231731687303715884105727")||j<BigInt("-170141183460469231731687303715884105728"))return new Error(`value ${j} must be between -170141183460469231731687303715884105728 and 170141183460469231731687303715884105727`);let q=new Uint8Array(16),z=new DataView(q.buffer),x=j;if(j<0n)x=(1n<<128n)+j;z.setBigUint64(0,x>>64n),z.setBigUint64(8,x&BigInt("0xffffffffffffffff"));let B=this.write(q);if(B instanceof Error)return B};writeBool=(j)=>{let q=this.writeUint8(j?1:0);if(q instanceof Error)return q};writePackedBools=(j)=>{if(j.length>8)return new Error("cannot pack more than 8 bools into a single byte");let q=0;for(let x of j)if(q<<=1,x)q|=1;q<<=8-j.length;let z=this.writeUint8(q);if(z instanceof Error)return z};writeString=(j)=>{if(!this.textEncoder)this.textEncoder=new TextEncoder;let q=this.textEncoder.encode(j),z=this.writeUint16(q.length);if(z instanceof Error)return z;let x=this.write(q);if(x instanceof Error)return x};writeRawBytes=(j)=>{let q=this.write(j);if(q instanceof Error)return q};writeArray=(j,q)=>{if(j.length>65535)return new Error(`array length ${j.length} exceeds maximum size of 65535`);let z=this.writeUint16(j.length);if(z instanceof Error)return z;for(let x of j){let B=q(x);if(B instanceof Error)return B}};readUint8=()=>{if(this.startReading(),this.position+1>this.inner.length)return new Error("attempted to read past the end of the Bufferfish");let j=new DataView(this.inner.buffer,this.position,1).getUint8(0);return this.position+=1,j};readUint16=()=>{if(this.startReading(),this.position+2>this.inner.length)return new Error("attempted to read past the end of the Bufferfish");let j=new DataView(this.inner.buffer,this.position,2).getUint16(0);return this.position+=2,j};readUint32=()=>{if(this.startReading(),this.position+4>this.inner.length)return new Error("attempted to read past the end of the Bufferfish");let j=new DataView(this.inner.buffer,this.position,4).getUint32(0);return this.position+=4,j};readUint64=()=>{if(this.startReading(),this.position+8>this.inner.length)return new Error("attempted to read past the end of the Bufferfish");let j=new DataView(this.inner.buffer,this.position,8).getBigUint64(0);return this.position+=8,j};readUint128=()=>{if(this.startReading(),this.position+16>this.inner.length)return new Error("attempted to read past the end of the Bufferfish");let j=new DataView(this.inner.buffer,this.position,8).getBigUint64(0),q=new DataView(this.inner.buffer,this.position+8,8).getBigUint64(0);return this.position+=16,j<<64n|q};readInt8=()=>{if(this.startReading(),this.position+1>this.inner.length)return new Error("attempted to read past the end of the Bufferfish");let j=new DataView(this.inner.buffer,this.position,1).getInt8(0);return this.position+=1,j};readInt16=()=>{if(this.startReading(),this.position+2>this.inner.length)return new Error("attempted to read past the end of the Bufferfish");let j=new DataView(this.inner.buffer,this.position,2).getInt16(0);return this.position+=2,j};readInt32=()=>{if(this.startReading(),this.position+4>this.inner.length)return new Error("attempted to read past the end of the Bufferfish");let j=new DataView(this.inner.buffer,this.position,4).getInt32(0);return this.position+=4,j};readInt64=()=>{if(this.startReading(),this.position+8>this.inner.length)return new Error("attempted to read past the end of the Bufferfish");let j=new DataView(this.inner.buffer,this.position,8).getBigInt64(0);return this.position+=8,j};readInt128=()=>{if(this.startReading(),this.position+16>this.inner.length)return new Error("attempted to read past the end of the Bufferfish");let j=new DataView(this.inner.buffer,this.position,8).getBigUint64(0),q=new DataView(this.inner.buffer,this.position+8,8).getBigUint64(0);this.position+=16;let z=j<<64n|q;if(z>>127n===1n)z=z-(1n<<128n);return z};readBool=()=>{let j=this.readUint8();if(j instanceof Error)return j;return j===1};readPackedBools=(j=8)=>{if(j>8)return new Error("cannot read more than 8 bools from a single byte");let q=this.readUint8();if(q instanceof Error)return q;let z=q,x=[];for(let B=0;B<j;B++)x.push((z&1<<7-B)!==0);return x};readString=()=>{let j=this.readUint16();if(j instanceof Error)return j;let q=j;if(this.position+q>this.inner.length)return new Error("attempted to read past the end of the Bufferfish");if(!this.textDecoder)this.textDecoder=new TextDecoder("utf-8");let z=this.textDecoder.decode(this.inner.subarray(this.position,this.position+q));return this.position+=q,z};readArray=(j)=>{let q=this.readUint16();if(q instanceof Error)return q;let z=q,x=new Array(z);try{for(let B=0;B<z;B++){let C=j();if(C instanceof Error)return C;x[B]=C}return x}catch(B){return B instanceof Error?B:new Error(String(B))}}}export{D as Bufferfish};

//# debugId=EC39DB7A84B5FF5764756E2164756E21
