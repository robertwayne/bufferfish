var __defProp=Object.defineProperty,__defNormalProp=(i,t,e)=>t in i?__defProp(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,__publicField=(i,t,e)=>(__defNormalProp(i,"symbol"!=typeof t?t+"":t,e),e);!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((i="undefined"!=typeof globalThis?globalThis:i||self).bufferfish={})}(this,(function(i){"use strict";i.Bufferfish=class{constructor(i=new ArrayBuffer(0)){__publicField(this,"inner"),__publicField(this,"pos"),__publicField(this,"reading"),__publicField(this,"capacity"),__publicField(this,"view",(()=>this.inner.slice())),__publicField(this,"writeUint8",(i=>{if(i>255||i<0)throw new Error("Value is out of range");this.write(new Uint8Array([i]))})),__publicField(this,"writeUint16",(i=>{if(i>65535||i<0)throw new Error("Value is out of range");this.write(new Uint8Array([i>>8,255&i]))})),__publicField(this,"writeUint32",(i=>{if(i>4294967295||i<0)throw new Error("Value is out of range");this.write(new Uint8Array([i>>24,i>>16&255,i>>8&255,255&i]))})),__publicField(this,"writeInt8",(i=>{if(i>127||i<-128)throw new Error("Value is out of range");this.write(new Uint8Array([i]))})),__publicField(this,"writeInt16",(i=>{if(i>32767||i<-32768)throw new Error("Value is out of range");this.write(new Uint8Array([i>>8,255&i]))})),__publicField(this,"writeInt32",(i=>{if(i>2147483647||i<-2147483648)throw new Error("Value is out of range");this.write(new Uint8Array([i>>24,i>>16&255,i>>8&255,255&i]))})),__publicField(this,"writeBool",(i=>{this.writeUint8(i?1:0)})),__publicField(this,"writePackedBools",(i=>{if(i.length>4)throw new Error("Each packed bool can only represent 4 or fewer values");let t=0;for(const e of i)t<<=1,e&&(t|=1);this.writeUint8(t)})),__publicField(this,"writeString",(i=>{const t=(new TextEncoder).encode(i);this.writeUint16(t.length),this.write(t)})),__publicField(this,"writeSizedString",(i=>{const t=(new TextEncoder).encode(i);this.write(t)})),__publicField(this,"readUint8",(()=>{this.start_reading();const i=new Uint8Array(1);return i.set(this.inner.subarray(this.pos,this.pos+1)),this.pos+=1,i[0]})),__publicField(this,"readUint16",(()=>{this.start_reading();const i=new Uint8Array(2);return i.set(this.inner.subarray(this.pos,this.pos+2)),this.pos+=2,i[0]<<8|i[1]})),__publicField(this,"readUint32",(()=>{this.start_reading();const i=new Uint8Array(4);return i.set(this.inner.subarray(this.pos,this.pos+4)),this.pos+=4,(i[0]<<24|i[1]<<16|i[2]<<8|i[3])>>>0})),__publicField(this,"readInt8",(()=>{this.start_reading();const i=new Uint8Array(1);i.set(this.inner.subarray(this.pos,this.pos+1)),this.pos+=1;const t=i[0];return 128&i[0]?-t:t})),__publicField(this,"readInt16",(()=>{this.start_reading();const i=new Uint8Array(2);i.set(this.inner.subarray(this.pos,this.pos+2)),this.pos+=2;const t=i[0]<<8|i[1];return 128&i[0]?-t:t})),__publicField(this,"readInt32",(()=>{this.start_reading();const i=new Uint8Array(4);i.set(this.inner.subarray(this.pos,this.pos+4)),this.pos+=4;const t=(i[0]<<24|i[1]<<16|i[2]<<8|i[3])>>>0;return 128&i[0]?-t:t})),__publicField(this,"readBool",(()=>{this.start_reading();const i=new Uint8Array(1);return i.set(this.inner.subarray(this.pos,this.pos+1)),this.pos+=1,1===i[0]})),__publicField(this,"readPackedBools",(()=>[])),__publicField(this,"readString",(()=>{this.start_reading();const i=this.readUint16(),t=this.inner.subarray(this.pos,this.pos+i),e=new TextDecoder("utf-8").decode(t);return this.pos+=i,e})),__publicField(this,"readSizedString",(i=>{this.start_reading();const t=this.inner.subarray(this.pos,this.pos+i),e=new TextDecoder("utf-8").decode(t);return this.pos+=i,e})),__publicField(this,"readStringRemaining",(()=>{this.start_reading();const i=this.inner.subarray(this.pos,this.inner.length),t=new TextDecoder("utf-8").decode(i);return this.pos=this.inner.length,t})),__publicField(this,"serialize",(i=>{})),__publicField(this,"serializeNumber",(i=>{})),__publicField(this,"serializeString",(i=>{})),__publicField(this,"serializeBoolean",(i=>{})),this.inner=new Uint8Array(i),this.pos=0,this.reading=!1,this.capacity=1024}write(i){if(i.length>this.capacity||this.inner.length+i.length>this.capacity)throw new Error("Bufferfish is full");this.reading=!1;const t=new Uint8Array(this.inner.length+i.length);t.set(this.inner,0),t.set(i,this.inner.length),this.inner=t;const e=i.length;return this.pos+=e,e}start_reading(){this.reading||(this.pos=0,this.reading=!0)}set_max_capacity(i){if(i<1)throw new Error("Max capacity must be at least 1 byte");this.capacity=i}},Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
