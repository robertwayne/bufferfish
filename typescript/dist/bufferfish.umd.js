(function(s,e){typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(s=typeof globalThis<"u"?globalThis:s||self,e(s.bufferfish={}))})(this,function(s){"use strict";var h=Object.defineProperty;var a=(s,e,o)=>e in s?h(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o;var r=(s,e,o)=>(a(s,typeof e!="symbol"?e+"":e,o),o);class e{constructor(t=new ArrayBuffer(0)){r(this,"inner");r(this,"pos");r(this,"reading");r(this,"capacity");r(this,"view",()=>this.inner.slice());r(this,"writeUint8",t=>{if(t>255||t<0)throw new Error("Value is out of range");this.write(new Uint8Array([t]))});r(this,"writeUint16",t=>{if(t>65535||t<0)throw new Error("Value is out of range");this.write(new Uint8Array([t>>8,t&255]))});r(this,"writeUint32",t=>{if(t>4294967295||t<0)throw new Error("Value is out of range");this.write(new Uint8Array([t>>24,t>>16&255,t>>8&255,t&255]))});r(this,"writeInt8",t=>{if(t>127||t<-128)throw new Error("Value is out of range");this.write(new Uint8Array([t]))});r(this,"writeInt16",t=>{if(t>32767||t<-32768)throw new Error("Value is out of range");this.write(new Uint8Array([t>>8,t&255]))});r(this,"writeInt32",t=>{if(t>2147483647||t<-2147483648)throw new Error("Value is out of range");this.write(new Uint8Array([t>>24,t>>16&255,t>>8&255,t&255]))});r(this,"writeBool",t=>{this.writeUint8(t?1:0)});r(this,"writePackedBools",t=>{if(t.length>4)throw new Error("Each packed bool can only represent 4 or fewer values");let i=0;for(const n of t)i<<=1,n&&(i|=1);this.writeUint8(i)});r(this,"writeString",t=>{const i=new TextEncoder().encode(t);this.writeUint16(i.length),this.write(i)});r(this,"writeSizedString",t=>{const i=new TextEncoder().encode(t);this.write(i)});r(this,"writeRawBytes",t=>{this.write(t)});r(this,"readUint8",()=>{this.start_reading();const t=new Uint8Array(1);return t.set(this.inner.subarray(this.pos,this.pos+1)),this.pos+=1,t[0]});r(this,"readUint16",()=>{this.start_reading();const t=new Uint8Array(2);return t.set(this.inner.subarray(this.pos,this.pos+2)),this.pos+=2,t[0]<<8|t[1]});r(this,"readUint32",()=>{this.start_reading();const t=new Uint8Array(4);return t.set(this.inner.subarray(this.pos,this.pos+4)),this.pos+=4,(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0});r(this,"readInt8",()=>{this.start_reading();const t=new Uint8Array(1);t.set(this.inner.subarray(this.pos,this.pos+1)),this.pos+=1;const i=t[0];return t[0]&128?-i:i});r(this,"readInt16",()=>{this.start_reading();const t=new Uint8Array(2);t.set(this.inner.subarray(this.pos,this.pos+2)),this.pos+=2;const i=t[0]<<8|t[1];return t[0]&128?-i:i});r(this,"readInt32",()=>{this.start_reading();const t=new Uint8Array(4);t.set(this.inner.subarray(this.pos,this.pos+4)),this.pos+=4;const i=(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0;return t[0]&128?-i:i});r(this,"readBool",()=>{this.start_reading();const t=new Uint8Array(1);return t.set(this.inner.subarray(this.pos,this.pos+1)),this.pos+=1,t[0]===1});r(this,"readPackedBools",()=>[]);r(this,"readString",()=>{this.start_reading();const t=this.readUint16(),i=this.inner.subarray(this.pos,this.pos+t),n=new TextDecoder("utf-8").decode(i);return this.pos+=t,n});r(this,"readSizedString",t=>{this.start_reading();const i=this.inner.subarray(this.pos,this.pos+t),n=new TextDecoder("utf-8").decode(i);return this.pos+=t,n});r(this,"readStringRemaining",()=>{this.start_reading();const t=this.inner.subarray(this.pos,this.inner.length),i=new TextDecoder("utf-8").decode(t);return this.pos=this.inner.length,i});this.inner=new Uint8Array(t),this.pos=0,this.reading=!1,this.capacity=1024}write(t){if(t.length>this.capacity||this.inner.length+t.length>this.capacity)throw new Error("Bufferfish is full");this.reading=!1;const i=new Uint8Array(this.inner.length+t.length);i.set(this.inner,0),i.set(t,this.inner.length),this.inner=i;const n=t.length;return this.pos+=n,n}start_reading(){this.reading||(this.pos=0,this.reading=!0)}set_max_capacity(t){if(t<1)throw new Error("Max capacity must be at least 1 byte");this.capacity=t}}s.Bufferfish=e,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
